import { memo, useCallback, useEffect } from "react";
import { formatCurrency } from "@/lib";
import { CustomBarChart, CustomPieChart, CustomCard, Card, CardHeader, CardContent, Record } from "@/components";
import Image from "next/image";
import Large from "@/assets/Large.png";
import { useChartData } from "@/hooks";
import withAuth from "@/utils/withAuth";

const Dashboard = () => {
  const { barChartData, pieChartData, fetchChartData } = useChartData();

  useEffect(() => {
    fetchChartData();
  }, [fetchChartData]);

  return (
    <div className="flex flex-col gap-6">
      <CardSection />
      <ChartSection barChartData={barChartData} pieChartData={pieChartData} />
      <Card>
        <CardHeader className="border-b-2">Last records</CardHeader>
        <CardContent className="flex flex-col gap-6 mt-5" >
            <Record
                label="Lending & Renting"
                balance={formatCurrency(-35500)}
                date="14:00">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="40"
                  height="40"
                  viewBox="0 0 40 40"
                  fill="none">
                  <circle cx="20" cy="20" r="20" fill="#FF4545" />
                  <path
                    d="M26.875 13.125V27.5C26.875 27.6658 26.8092 27.8247 26.6919 27.9419C26.5747 28.0592 26.4158 28.125 26.25 28.125C26.0842 28.125 25.9253 28.0592 25.8081 27.9419C25.6908 27.8247 25.625 27.6658 25.625 27.5V23.75H21.875C21.7092 23.75 21.5503 23.6842 21.4331 23.5669C21.3158 23.4497 21.25 23.2908 21.25 23.125C21.279 21.6279 21.4681 20.1382 21.8141 18.6813C22.5781 15.518 24.0266 13.3977 26.0039 12.5508C26.0989 12.5101 26.2026 12.4936 26.3056 12.5028C26.4086 12.512 26.5077 12.5466 26.594 12.6035C26.6803 12.6604 26.7512 12.7378 26.8002 12.8288C26.8493 12.9199 26.875 13.0216 26.875 13.125ZM19.3664 13.0227C19.3542 12.9406 19.3257 12.8618 19.2827 12.7908C19.2397 12.7199 19.183 12.6582 19.1158 12.6094C19.0487 12.5606 18.9726 12.5257 18.8918 12.5066C18.8111 12.4875 18.7273 12.4847 18.6455 12.4984C18.5636 12.512 18.4853 12.5418 18.4151 12.586C18.3449 12.6303 18.2842 12.688 18.2366 12.756C18.1889 12.8239 18.1553 12.9006 18.1376 12.9817C18.1199 13.0628 18.1186 13.1465 18.1336 13.2281L18.7414 16.875H16.875V13.125C16.875 12.9592 16.8092 12.8003 16.6919 12.6831C16.5747 12.5659 16.4158 12.5 16.25 12.5C16.0842 12.5 15.9253 12.5659 15.8081 12.6831C15.6908 12.8003 15.625 12.9592 15.625 13.125V16.875H13.7586L14.3664 13.2281C14.3814 13.1465 14.3801 13.0628 14.3624 12.9817C14.3447 12.9006 14.3111 12.8239 14.2634 12.756C14.2158 12.688 14.1551 12.6303 14.0849 12.586C14.0147 12.5418 13.9364 12.512 13.8545 12.4984C13.7727 12.4847 13.6889 12.4875 13.6082 12.5066C13.5274 12.5257 13.4513 12.5606 13.3842 12.6094C13.317 12.6582 13.2603 12.7199 13.2173 12.7908C13.1743 12.8618 13.1458 12.9406 13.1336 13.0227L12.5086 16.7727C12.503 16.8065 12.5001 16.8407 12.5 16.875C12.5012 17.7608 12.8156 18.6176 13.3874 19.2941C13.9592 19.9706 14.7518 20.4232 15.625 20.5719V27.5C15.625 27.6658 15.6908 27.8247 15.8081 27.9419C15.9253 28.0592 16.0842 28.125 16.25 28.125C16.4158 28.125 16.5747 28.0592 16.6919 27.9419C16.8092 27.8247 16.875 27.6658 16.875 27.5V20.5719C17.7482 20.4232 18.5408 19.9706 19.1126 19.2941C19.6844 18.6176 19.9988 17.7608 20 16.875C19.9999 16.8407 19.997 16.8065 19.9914 16.7727L19.3664 13.0227Z"
                    fill="white"
                  />
                </svg>
              </Record>
            <Record
                label="Lending & Renting"
                balance={formatCurrency(-35500)}
                date="14:00">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="40"
                  height="40"
                  viewBox="0 0 40 40"
                  fill="none">
                  <circle cx="20" cy="20" r="20" fill="#FF4545" />
                  <path
                    d="M26.875 13.125V27.5C26.875 27.6658 26.8092 27.8247 26.6919 27.9419C26.5747 28.0592 26.4158 28.125 26.25 28.125C26.0842 28.125 25.9253 28.0592 25.8081 27.9419C25.6908 27.8247 25.625 27.6658 25.625 27.5V23.75H21.875C21.7092 23.75 21.5503 23.6842 21.4331 23.5669C21.3158 23.4497 21.25 23.2908 21.25 23.125C21.279 21.6279 21.4681 20.1382 21.8141 18.6813C22.5781 15.518 24.0266 13.3977 26.0039 12.5508C26.0989 12.5101 26.2026 12.4936 26.3056 12.5028C26.4086 12.512 26.5077 12.5466 26.594 12.6035C26.6803 12.6604 26.7512 12.7378 26.8002 12.8288C26.8493 12.9199 26.875 13.0216 26.875 13.125ZM19.3664 13.0227C19.3542 12.9406 19.3257 12.8618 19.2827 12.7908C19.2397 12.7199 19.183 12.6582 19.1158 12.6094C19.0487 12.5606 18.9726 12.5257 18.8918 12.5066C18.8111 12.4875 18.7273 12.4847 18.6455 12.4984C18.5636 12.512 18.4853 12.5418 18.4151 12.586C18.3449 12.6303 18.2842 12.688 18.2366 12.756C18.1889 12.8239 18.1553 12.9006 18.1376 12.9817C18.1199 13.0628 18.1186 13.1465 18.1336 13.2281L18.7414 16.875H16.875V13.125C16.875 12.9592 16.8092 12.8003 16.6919 12.6831C16.5747 12.5659 16.4158 12.5 16.25 12.5C16.0842 12.5 15.9253 12.5659 15.8081 12.6831C15.6908 12.8003 15.625 12.9592 15.625 13.125V16.875H13.7586L14.3664 13.2281C14.3814 13.1465 14.3801 13.0628 14.3624 12.9817C14.3447 12.9006 14.3111 12.8239 14.2634 12.756C14.2158 12.688 14.1551 12.6303 14.0849 12.586C14.0147 12.5418 13.9364 12.512 13.8545 12.4984C13.7727 12.4847 13.6889 12.4875 13.6082 12.5066C13.5274 12.5257 13.4513 12.5606 13.3842 12.6094C13.317 12.6582 13.2603 12.7199 13.2173 12.7908C13.1743 12.8618 13.1458 12.9406 13.1336 13.0227L12.5086 16.7727C12.503 16.8065 12.5001 16.8407 12.5 16.875C12.5012 17.7608 12.8156 18.6176 13.3874 19.2941C13.9592 19.9706 14.7518 20.4232 15.625 20.5719V27.5C15.625 27.6658 15.6908 27.8247 15.8081 27.9419C15.9253 28.0592 16.0842 28.125 16.25 28.125C16.4158 28.125 16.5747 28.0592 16.6919 27.9419C16.8092 27.8247 16.875 27.6658 16.875 27.5V20.5719C17.7482 20.4232 18.5408 19.9706 19.1126 19.2941C19.6844 18.6176 19.9988 17.7608 20 16.875C19.9999 16.8407 19.997 16.8065 19.9914 16.7727L19.3664 13.0227Z"
                    fill="white"
                  />
                </svg>
              </Record>
            <Record
                label="Lending & Renting"
                balance={formatCurrency(-35500)}
                date="14:00">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="40"
                  height="40"
                  viewBox="0 0 40 40"
                  fill="none">
                  <circle cx="20" cy="20" r="20" fill="#FF4545" />
                  <path
                    d="M26.875 13.125V27.5C26.875 27.6658 26.8092 27.8247 26.6919 27.9419C26.5747 28.0592 26.4158 28.125 26.25 28.125C26.0842 28.125 25.9253 28.0592 25.8081 27.9419C25.6908 27.8247 25.625 27.6658 25.625 27.5V23.75H21.875C21.7092 23.75 21.5503 23.6842 21.4331 23.5669C21.3158 23.4497 21.25 23.2908 21.25 23.125C21.279 21.6279 21.4681 20.1382 21.8141 18.6813C22.5781 15.518 24.0266 13.3977 26.0039 12.5508C26.0989 12.5101 26.2026 12.4936 26.3056 12.5028C26.4086 12.512 26.5077 12.5466 26.594 12.6035C26.6803 12.6604 26.7512 12.7378 26.8002 12.8288C26.8493 12.9199 26.875 13.0216 26.875 13.125ZM19.3664 13.0227C19.3542 12.9406 19.3257 12.8618 19.2827 12.7908C19.2397 12.7199 19.183 12.6582 19.1158 12.6094C19.0487 12.5606 18.9726 12.5257 18.8918 12.5066C18.8111 12.4875 18.7273 12.4847 18.6455 12.4984C18.5636 12.512 18.4853 12.5418 18.4151 12.586C18.3449 12.6303 18.2842 12.688 18.2366 12.756C18.1889 12.8239 18.1553 12.9006 18.1376 12.9817C18.1199 13.0628 18.1186 13.1465 18.1336 13.2281L18.7414 16.875H16.875V13.125C16.875 12.9592 16.8092 12.8003 16.6919 12.6831C16.5747 12.5659 16.4158 12.5 16.25 12.5C16.0842 12.5 15.9253 12.5659 15.8081 12.6831C15.6908 12.8003 15.625 12.9592 15.625 13.125V16.875H13.7586L14.3664 13.2281C14.3814 13.1465 14.3801 13.0628 14.3624 12.9817C14.3447 12.9006 14.3111 12.8239 14.2634 12.756C14.2158 12.688 14.1551 12.6303 14.0849 12.586C14.0147 12.5418 13.9364 12.512 13.8545 12.4984C13.7727 12.4847 13.6889 12.4875 13.6082 12.5066C13.5274 12.5257 13.4513 12.5606 13.3842 12.6094C13.317 12.6582 13.2603 12.7199 13.2173 12.7908C13.1743 12.8618 13.1458 12.9406 13.1336 13.0227L12.5086 16.7727C12.503 16.8065 12.5001 16.8407 12.5 16.875C12.5012 17.7608 12.8156 18.6176 13.3874 19.2941C13.9592 19.9706 14.7518 20.4232 15.625 20.5719V27.5C15.625 27.6658 15.6908 27.8247 15.8081 27.9419C15.9253 28.0592 16.0842 28.125 16.25 28.125C16.4158 28.125 16.5747 28.0592 16.6919 27.9419C16.8092 27.8247 16.875 27.6658 16.875 27.5V20.5719C17.7482 20.4232 18.5408 19.9706 19.1126 19.2941C19.6844 18.6176 19.9988 17.7608 20 16.875C19.9999 16.8407 19.997 16.8065 19.9914 16.7727L19.3664 13.0227Z"
                    fill="white"
                  />
                </svg>
              </Record>
            <Record
                label="Lending & Renting"
                balance={formatCurrency(-35500)}
                date="14:00">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="40"
                  height="40"
                  viewBox="0 0 40 40"
                  fill="none">
                  <circle cx="20" cy="20" r="20" fill="#FF4545" />
                  <path
                    d="M26.875 13.125V27.5C26.875 27.6658 26.8092 27.8247 26.6919 27.9419C26.5747 28.0592 26.4158 28.125 26.25 28.125C26.0842 28.125 25.9253 28.0592 25.8081 27.9419C25.6908 27.8247 25.625 27.6658 25.625 27.5V23.75H21.875C21.7092 23.75 21.5503 23.6842 21.4331 23.5669C21.3158 23.4497 21.25 23.2908 21.25 23.125C21.279 21.6279 21.4681 20.1382 21.8141 18.6813C22.5781 15.518 24.0266 13.3977 26.0039 12.5508C26.0989 12.5101 26.2026 12.4936 26.3056 12.5028C26.4086 12.512 26.5077 12.5466 26.594 12.6035C26.6803 12.6604 26.7512 12.7378 26.8002 12.8288C26.8493 12.9199 26.875 13.0216 26.875 13.125ZM19.3664 13.0227C19.3542 12.9406 19.3257 12.8618 19.2827 12.7908C19.2397 12.7199 19.183 12.6582 19.1158 12.6094C19.0487 12.5606 18.9726 12.5257 18.8918 12.5066C18.8111 12.4875 18.7273 12.4847 18.6455 12.4984C18.5636 12.512 18.4853 12.5418 18.4151 12.586C18.3449 12.6303 18.2842 12.688 18.2366 12.756C18.1889 12.8239 18.1553 12.9006 18.1376 12.9817C18.1199 13.0628 18.1186 13.1465 18.1336 13.2281L18.7414 16.875H16.875V13.125C16.875 12.9592 16.8092 12.8003 16.6919 12.6831C16.5747 12.5659 16.4158 12.5 16.25 12.5C16.0842 12.5 15.9253 12.5659 15.8081 12.6831C15.6908 12.8003 15.625 12.9592 15.625 13.125V16.875H13.7586L14.3664 13.2281C14.3814 13.1465 14.3801 13.0628 14.3624 12.9817C14.3447 12.9006 14.3111 12.8239 14.2634 12.756C14.2158 12.688 14.1551 12.6303 14.0849 12.586C14.0147 12.5418 13.9364 12.512 13.8545 12.4984C13.7727 12.4847 13.6889 12.4875 13.6082 12.5066C13.5274 12.5257 13.4513 12.5606 13.3842 12.6094C13.317 12.6582 13.2603 12.7199 13.2173 12.7908C13.1743 12.8618 13.1458 12.9406 13.1336 13.0227L12.5086 16.7727C12.503 16.8065 12.5001 16.8407 12.5 16.875C12.5012 17.7608 12.8156 18.6176 13.3874 19.2941C13.9592 19.9706 14.7518 20.4232 15.625 20.5719V27.5C15.625 27.6658 15.6908 27.8247 15.8081 27.9419C15.9253 28.0592 16.0842 28.125 16.25 28.125C16.4158 28.125 16.5747 28.0592 16.6919 27.9419C16.8092 27.8247 16.875 27.6658 16.875 27.5V20.5719C17.7482 20.4232 18.5408 19.9706 19.1126 19.2941C19.6844 18.6176 19.9988 17.7608 20 16.875C19.9999 16.8407 19.997 16.8065 19.9914 16.7727L19.3664 13.0227Z"
                    fill="white"
                  />
                </svg>
              </Record>
            <Record
                label="Lending & Renting"
                balance={formatCurrency(-35500)}
                date="14:00">
                <svg
                  xmlns="http://www.w3.org/2000/svg"
                  width="40"
                  height="40"
                  viewBox="0 0 40 40"
                  fill="none">
                  <circle cx="20" cy="20" r="20" fill="#FF4545" />
                  <path
                    d="M26.875 13.125V27.5C26.875 27.6658 26.8092 27.8247 26.6919 27.9419C26.5747 28.0592 26.4158 28.125 26.25 28.125C26.0842 28.125 25.9253 28.0592 25.8081 27.9419C25.6908 27.8247 25.625 27.6658 25.625 27.5V23.75H21.875C21.7092 23.75 21.5503 23.6842 21.4331 23.5669C21.3158 23.4497 21.25 23.2908 21.25 23.125C21.279 21.6279 21.4681 20.1382 21.8141 18.6813C22.5781 15.518 24.0266 13.3977 26.0039 12.5508C26.0989 12.5101 26.2026 12.4936 26.3056 12.5028C26.4086 12.512 26.5077 12.5466 26.594 12.6035C26.6803 12.6604 26.7512 12.7378 26.8002 12.8288C26.8493 12.9199 26.875 13.0216 26.875 13.125ZM19.3664 13.0227C19.3542 12.9406 19.3257 12.8618 19.2827 12.7908C19.2397 12.7199 19.183 12.6582 19.1158 12.6094C19.0487 12.5606 18.9726 12.5257 18.8918 12.5066C18.8111 12.4875 18.7273 12.4847 18.6455 12.4984C18.5636 12.512 18.4853 12.5418 18.4151 12.586C18.3449 12.6303 18.2842 12.688 18.2366 12.756C18.1889 12.8239 18.1553 12.9006 18.1376 12.9817C18.1199 13.0628 18.1186 13.1465 18.1336 13.2281L18.7414 16.875H16.875V13.125C16.875 12.9592 16.8092 12.8003 16.6919 12.6831C16.5747 12.5659 16.4158 12.5 16.25 12.5C16.0842 12.5 15.9253 12.5659 15.8081 12.6831C15.6908 12.8003 15.625 12.9592 15.625 13.125V16.875H13.7586L14.3664 13.2281C14.3814 13.1465 14.3801 13.0628 14.3624 12.9817C14.3447 12.9006 14.3111 12.8239 14.2634 12.756C14.2158 12.688 14.1551 12.6303 14.0849 12.586C14.0147 12.5418 13.9364 12.512 13.8545 12.4984C13.7727 12.4847 13.6889 12.4875 13.6082 12.5066C13.5274 12.5257 13.4513 12.5606 13.3842 12.6094C13.317 12.6582 13.2603 12.7199 13.2173 12.7908C13.1743 12.8618 13.1458 12.9406 13.1336 13.0227L12.5086 16.7727C12.503 16.8065 12.5001 16.8407 12.5 16.875C12.5012 17.7608 12.8156 18.6176 13.3874 19.2941C13.9592 19.9706 14.7518 20.4232 15.625 20.5719V27.5C15.625 27.6658 15.6908 27.8247 15.8081 27.9419C15.9253 28.0592 16.0842 28.125 16.25 28.125C16.4158 28.125 16.5747 28.0592 16.6919 27.9419C16.8092 27.8247 16.875 27.6658 16.875 27.5V20.5719C17.7482 20.4232 18.5408 19.9706 19.1126 19.2941C19.6844 18.6176 19.9988 17.7608 20 16.875C19.9999 16.8407 19.997 16.8065 19.9914 16.7727L19.3664 13.0227Z"
                    fill="white"
                  />
                </svg>
              </Record>
        </CardContent>
      </Card>
    </div>
  );
};

const CardSection = () => (
  <div className="flex gap-6">
    <CardWithImage />
    <CustomCard />
    <CustomCard
      color="bg-[#0166FF]"
      title="Total Expenses"
      balance={-1200000}
      percent={-30}
    />
  </div>
);

const ChartSection = memo(({ barChartData, pieChartData }) => (
  <div className="flex gap-6">
    <CustomBarChart chartData={barChartData} />
    <CustomPieChart chartData={pieChartData} />
  </div>
));

const CardWithImage = memo(() => (
  <div className="relative">
    <Image alt="VirtualCard" src={Large} width={384} height={216} />
    <div className="absolute z-10 text-white bottom-10 left-10">
      <p className="leading-6 opacity-50">Cash</p>
      <span className="text-[24px] leading-8 font-semibold">
        {formatCurrency(1000000)}
      </span>
    </div>
  </div>
));

export default withAuth(memo(Dashboard));

